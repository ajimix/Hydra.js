(function (j, m) {
    var b = {},
        a = null,
        o = false,
        d = function () {},
        h = function () {},
        f = function () {};

    function c(p) {
        return Object.prototype.toString.call(p) === "[object Function]"
    }
    function n() {
        return f
    }
    function e() {
        return d
    }
    function g(p) {
        d = p
    }
    function i(p) {
        o = p
    }
    function l(q, s, r, p) {
        q[s] = (function (u, t) {
            return function () {
                var w = Array.prototype.slice.call(arguments, 0);
                try {
                    return t.apply(this, w)
                } catch (v) {
                    d.log(r, u, v)
                } finally {
                    w = null
                }
            }
        }(s, p))
    }
    function k(r) {
        if (typeof b[r] === "undefined") {
            throw new Error("The module is not registered!")
        }
        var t = new f(),
            q = b[r].creator(t),
            s = "",
            p = function () {};
        q.__action__ = t;
        if (!o) {
            for (s in q) {
                if (q.hasOwnProperty(s)) {
                    p = q[s];
                    if (!c(p)) {
                        continue
                    }
                    l(q, s, r, p)
                }
            }
        }
        return q
    }
    d.type = "ErrorHandler";
    d.list = null;
    d.create_dom = function () {
        var p = m.createElement("div"),
            r = m.createElement("ul"),
            q = p.style;
        q.display = "none";
        q.position = "fixed";
        q.height = "100px";
        q.width = "100%";
        q.bottom = "0px";
        this.list = r;
        p.appendChild(r);
        m.body.appendChild(p);
        p = r = q = null
    };
    d.addItem = function (q, p, r) {
        var s = m.createElement("li");
        s.appendChild(m.createTextNode(q + "/" + p + ": " + r.message));
        this.list.appendChild(s);
        s = null
    };
    d.log = function () {
        var p = Array.prototype.slice.call(arguments, 0);
        if (typeof j.console === "undefined" || (typeof p[p.length - 1] == "boolean" && !p[p.length - 1])) {
            if (this.list === null) {
                this.create_dom()
            }
            this.addItem.apply(this, p);
            d.__old_log__ = d.log;
            this.log = function () {
                var q = Array.prototype.slice.call(arguments, 0);
                this.addItem.apply(this, q);
                q = null
            }
        } else {
            j.console.log.apply(j.console, p);
            d.__old_log__ = d.log;
            this.log = function () {
                var q = Array.prototype.slice.call(arguments, 0);
                j.console.log.apply(j.console, q);
                q = null
            }
        }
        p = null
    };
    h.prototype.type = "Module";
    h.prototype.register = function (q, p) {
        b[q] = {
            creator: p,
            instance: null
        }
    };
    h.prototype._merge = function (u, p, s) {
        var q = {};
        if (s) {
            q.__super__ = {};
            q.__super__.__instance__ = u;
            q.__super__.__call__ = function (w, x) {
                var v = this;
                while (!(w in v)) {
                    v = v.__instance__.__super__
                }
                v[w].apply(q, x)
            }
        }
        var t = "";
        for (t in u) {
            if (u.hasOwnProperty(t)) {
                if (t === "__super__") {
                    continue
                }
                q[t] = u[t]
            }
        }
        function r(v) {
            return function () {
                var w = Array.prototype.slice.call(arguments, 0);
                v.apply(this, w)
            }
        }
        for (t in p) {
            if (p.hasOwnProperty(t)) {
                if (typeof q.__super__ !== "undefined" && Object.prototype.toString.call(q[t]) === "[object Function]") {
                    q.__super__[t] = (r(q[t]));
                    q[t] = p[t]
                } else {
                    q[t] = p[t]
                }
            }
        }
        return q
    };
    h.prototype.extend = function (v, r, t) {
        var q = b[v];
        var u = v;
        var y = function () {};
        var s = null;
        var w = null;
        var p = null;
        var x = null;
        if ("string" == typeof r) {
            u = r;
            y = t
        } else {
            y = r
        }
        if (typeof q === "undefined") {
            return
        }
        x = new f();
        w = y(x);
        s = q.creator(x);
        p = this._merge(s, w, (u !== v));
        p.__action__ = x;
        b[u] = {
            creator: function (z) {
                return p
            },
            instance: null
        }
    };
    h.prototype.test = function (p, q) {
        o = true;
        q(k(p));
        o = false
    };
    h.prototype.start = function (p, r) {
        var q = b[p];
        if (typeof q !== "undefined") {
            q.instance = k(p);
            q.instance.init(r)
        }
        q = null
    };
    h.prototype.startAll = function () {
        var p = "";
        for (p in b) {
            if (b.hasOwnProperty(p)) {
                this.start(p)
            }
        }
        p = null
    };
    h.prototype.stop = function (p) {
        var q = b[p];
        if (typeof q !== "undefined" && q.instance !== null) {
            q.instance.destroy();
            q.instance = null
        }
    };
    h.prototype.stopAll = function () {
        var p = "";
        for (p in b) {
            if (b.hasOwnProperty(p)) {
                this.stop(p)
            }
        }
        p = null
    };
    h.prototype._delete = function (p) {
        delete b[p]
    };
    h.prototype.remove = function (p) {
        var q = b[p];
        if (typeof q !== "undefined") {
            b[p] = null;
            this._delete(p)
        }
    };
    f.type = "Action";
    f.oActions = {};
    f.prototype.listen = function (t, r, u) {
        var q = "",
            p = 0,
            s = t.length;
        for (; p < s; p++) {
            q = t[p];
            if (typeof f.oActions[q] === "undefined") {
                f.oActions[q] = []
            }
            f.oActions[q].push({
                module: u,
                handler: r
            })
        }
    };
    f.prototype.notify = function (s) {
        var u = s.type,
            t = null,
            q = 0,
            p = 0,
            r = f.oActions;
        if (typeof r[u] === "undefined") {
            return
        }
        p = r[u].length;
        for (; q < p; q++) {
            t = r[u][q];
            t.handler.call(t.module, s)
        }
        u = t = q = p = r = null
    };
    f.prototype.stopListen = function (v, t) {
        var x = "",
            u = [],
            w = 0,
            p = v.length,
            r = 0,
            s = 0,
            q = f.oActions;
        for (; w < p; w++) {
            x = v[w];
            s = q[x].length;
            for (; r < s; r++) {
                if (t !== q[x][r].module) {
                    u.push(q[x][r])
                }
            }
            q[x] = u;
            if (q[x].length === 0) {
                delete q[x]
            }
        }
    };
    f.prototype.__restore__ = function () {
        f.oActions = {}
    };
    a = {
        action: n,
        errorHandler: e,
        setErrorHandler: g,
        module: new h(),
        setDebug: i
    };
    j.Hydra = a
}(window, document));