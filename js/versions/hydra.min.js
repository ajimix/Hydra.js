(function (j, m) {
  var b = {},
      a = null,
      o = false,
      d = function () {},
      h = function () {},
      f = function () {};
  function c(p) {
    return Object.prototype.toString.call(p) === "[object Function]"
  }
  function n() {
    return f
  }
  function e() {
    return d
  }
  function g(p) {
    d = p
  }
  function i(p) {
    o = p
  }
  function l(q, s, r, p) {
    q[s] = (function (u, t) {
      return function () {
        var w = Array.prototype.slice.call(arguments, 0);
        try {
          return t.apply(this, w)
        } catch (v) {
          d.log(r, u, v)
        } finally {
          w = null
        }
      }
    }(s, p))
  }
  function k(r) {
    if (typeof b[r] === "undefined") {
      throw new Error("The module is not registered!")
    }
    var q = b[r].creator(new f()),
        s = "",
        p = function () {};
    if (!o) {
      for (s in q) {
        if (q.hasOwnProperty(s)) {
          p = q[s];
          if (!c(p)) {
            continue
          }
          l(q, s, r, p)
        }
      }
    }
    return q
  }
  d.type = "ErrorHandler";
  d.list = null;
  d.create_dom = function () {
    var p = m.createElement("div"),
        r = m.createElement("ul"),
        q = p.style;
    q.display = "none";
    q.position = "fixed";
    q.height = "100px";
    q.width = "100%";
    q.bottom = "0px";
    this.list = r;
    p.appendChild(r);
    m.body.appendChild(p);
    p = r = q = null
  };
  d.addItem = function (q, p, r) {
    var s = m.createElement("li");
    s.appendChild(m.createTextNode(q + "/" + p + ": " + r.message));
    this.list.appendChild(s);
    s = null
  };
  d.log = function () {
    var p = Array.prototype.slice.call(arguments, 0);
    if (typeof window.console === "undefined" || (typeof p[p.length - 1] == "boolean" && !p[p.length - 1])) {
      if (this.list === null) {
        this.create_dom()
      }
      this.addItem.apply(this, p);
      d.__old_log__ = d.log;
      this.log = function () {
        var q = Array.prototype.slice.call(arguments, 0);
        this.addItem.apply(this, q);
        q = null
      }
    } else {
      j.console.log.apply(j.console, p);
      d.__old_log__ = d.log;
      this.log = function () {
        var q = Array.prototype.slice.call(arguments, 0);
        j.console.log.apply(j.console, q);
        q = null
      }
    }
    p = null
  };
  h.prototype.type = "Module";
  h.prototype.register = function (q, p) {
    b[q] = {
      creator: p,
      instance: null
    }
  };
  h.prototype.merge = function (s, p) {
    var q = {},
        r = "";
    for (r in s) {
      if (s.hasOwnProperty(r)) {
        q[r] = s[r]
      }
    }
    for (r in p) {
      if (p.hasOwnProperty(r)) {
        q[r] = p[r]
      }
    }
    return q
  };
  h.prototype.extend = function (t, p) {
    var v = b[t],
        q = this,
        u = null,
        s = null,
        r = null;
    if (typeof v === "undefined") {
      return
    }
    s = p(new f());
    u = v.creator(new f());
    r = this.merge(u, s), b[t] = {
      creator: function (w) {
        return r
      },
      instance: null
    };
    v = u = s = null
  };
  h.prototype.test = function (p, q) {
    o = true;
    q(k(p));
    o = false
  };
  h.prototype.start = function (p, r) {
    var q = b[p];
    if (typeof q !== "undefined") {
      q.instance = k(p);
      q.instance.init(r)
    }
    q = null
  };
  h.prototype.startAll = function () {
    var p = "";
    for (p in b) {
      if (b.hasOwnProperty(p)) {
        this.start(p)
      }
    }
    p = null
  };
  h.prototype.stop = function (p) {
    var q = b[p];
    if (typeof q !== "undefined" && !(q.instance == null)) {
      q.instance.destroy();
      q.instance = null
    }
  };
  h.prototype.stopAll = function () {
    var p = "";
    for (p in b) {
      if (b.hasOwnProperty(p)) {
        this.stop(p)
      }
    }
    p = null
  };
  h.prototype._delete = function (p) {
    delete b[p]
  };
  h.prototype.remove = function (p) {
    var q = b[p];
    if (typeof q !== "undefined") {
      b[p] = null;
      this._delete(p)
    }
  };
  f.type = "Action";
  f.oActions = {};
  f.prototype.listen = function (t, r, u) {
    var q = "",
        p = 0,
        s = t.length;
    for (; p < s; p++) {
      q = t[p];
      if (typeof f.oActions[q] === "undefined") {
        f.oActions[q] = []
      }
      f.oActions[q].push({
        module: u,
        handler: r
      })
    }
  };
  f.prototype.notify = function (s) {
    var u = s.type,
        t = null,
        q = 0,
        p = 0,
        r = f.oActions;
    if (typeof r[u] === "undefined") {
      return
    }
    p = r[u].length;
    for (; q < p; q++) {
      t = r[u][q];
      t.handler.call(t.module, s)
    }
    u = t = q = p = r = null
  };
  f.prototype.stopListen = function (v, t) {
    var x = "",
        u = [],
        w = 0,
        p = v.length,
        r = 0,
        s = 0,
        q = f.oActions;
    for (; w < p; w++) {
      x = v[w];
      s = q[x].length;
      for (; r < s; r++) {
        if (t !== q[x][r].module) {
          u.push(q[x][r])
        }
      }
      q[x] = u;
      if (q[x].length === 0) {
        delete q[x]
      }
    }
  };
  f.prototype.__restore__ = function () {
    f.oActions = {}
  };
  a = {
    action: n,
    errorHandler: e,
    setErrorHandler: g,
    module: new h(),
    setDebug: i
  };
  j.Hydra = a
}(window, document));